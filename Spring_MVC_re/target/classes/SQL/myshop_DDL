-- 회원
ALTER TABLE Member
	DROP CONSTRAINT PK_Member; -- 회원 기본키

-- 회원
DROP TABLE Member;

-- 회원
CREATE TABLE Member (
	userid  VARCHAR2(20)  NOT NULL, -- 아이디
	name    varchar2(30)  NOT NULL, -- 이름
	pwd     varchar2(20)  NOT NULL, -- 비밀번호
	hp1     char(3)       NOT NULL, -- 연락처1
	hp2     char(4)       NOT NULL, -- 연락처2
	hp3     char(4)       NOT NULL, -- 연락처3
	post    char(5)       NOT NULL, -- 우편번호
	addr1   varchar2(100) NULL,     -- 주소1
	addr2   varchar2(100) NULL,     -- 주소2
	indate  DATE          NULL,     -- 가입일
	mileage number(8)     NULL,     -- 마일리지
	mstate  number(1)     NULL      -- 회원상태
);

-- 회원 기본키
CREATE UNIQUE INDEX PK_Member
	ON Member ( -- 회원
		userid ASC -- 아이디
	);

-- 회원
ALTER TABLE Member
	ADD
		CONSTRAINT PK_Member -- 회원 기본키
		PRIMARY KEY (
			userid -- 아이디
		);
------------------------------------------------------------

-- 상위 카테고리
ALTER TABLE upCategory
	DROP CONSTRAINT PK_upCategory; -- 상위 카테고리 기본키

-- 상위 카테고리
DROP TABLE upCategory;

-- 상위 카테고리
CREATE TABLE upCategory (
	upcg_code number(8)    NOT NULL, -- 상위 카테고리 코드
	upcg_name varchar2(30) NOT NULL  -- 상위 카테고리명
);

-- 상위 카테고리 기본키
CREATE UNIQUE INDEX PK_upCategory
	ON upCategory ( -- 상위 카테고리
		upcg_code ASC -- 상위 카테고리 코드
	);

-- 상위 카테고리
ALTER TABLE upCategory
	ADD
		CONSTRAINT PK_upCategory -- 상위 카테고리 기본키
		PRIMARY KEY (
			upcg_code -- 상위 카테고리 코드
		);
----------------------------------------------------------
-- 하위 카테고리
ALTER TABLE downCategory
	DROP CONSTRAINT FK_upCategory_TO_downCategory; -- 상위 카테고리 -> 하위 카테고리

-- 하위 카테고리
ALTER TABLE downCategory
	DROP CONSTRAINT PK_downCategory; -- 하위 카테고리 기본키

-- 하위 카테고리
DROP TABLE downCategory;

-- 하위 카테고리
CREATE TABLE downCategory (
	upcg_code   number(8)    NOT NULL, -- 상위 카테고리 코드
	downcg_code number(8)    NOT NULL, -- 하위 카테고리 코드
	downcg_name varchar2(30) NULL      -- 하위 카테고리명
);

-- 하위 카테고리 기본키
CREATE UNIQUE INDEX PK_downCategory
	ON downCategory ( -- 하위 카테고리
		upcg_code   ASC, -- 상위 카테고리 코드
		downcg_code ASC  -- 하위 카테고리 코드
	);

-- 하위 카테고리
ALTER TABLE downCategory
	ADD
		CONSTRAINT PK_downCategory -- 하위 카테고리 기본키
		PRIMARY KEY (
			upcg_code,   -- 상위 카테고리 코드
			downcg_code  -- 하위 카테고리 코드
		);
        
-- 하위 카테고리
ALTER TABLE downCategory
	ADD
		CONSTRAINT FK_upCategory_TO_downCategory -- 상위 카테고리 -> 하위 카테고리
		FOREIGN KEY (
			upcg_code -- 상위 카테고리 코드
		)
		REFERENCES upCategory ( -- 상위 카테고리
			upcg_code -- 상위 카테고리 코드
		);
--------------------------------------------
-- 상품
ALTER TABLE Products
	DROP CONSTRAINT FK_downCategory_TO_Products; -- 하위 카테고리 -> 상품

-- 상품
ALTER TABLE Products
	DROP CONSTRAINT FK_upCategory_TO_Products; -- 상위 카테고리 -> 상품

-- 상품
ALTER TABLE Products
	DROP CONSTRAINT PK_Products; -- 상품 기본키

-- 상품
DROP TABLE Products;

-- 상품
CREATE TABLE Products (
	pnum        number(8)      NOT NULL, -- 상품번호
	pname       varchar2(30)   NOT NULL, -- 상품명
	pimage1     varchar2(100)  NULL,     -- 이미지1
	pimage2     varchar2(100)  NULL,     -- 이미지2
	pimage3     varchar2(100)  NULL,     -- 이미지3
	price       number(8)      NOT NULL, -- 상품 정가
	saleprice   number(8)      NOT NULL, -- 상품 판매가
	pqty        number(8)      NULL,     -- 상품 수량
	point       number(8)      NULL,     -- 포인트
	pspec       varchar2(20)   NULL,     -- 스펙
	pcontents   varchar2(1000) NULL,     -- 상품설명
	pcompany    varchar2(50)   NULL,     -- 제조사
	pdate       DATE           NULL,     -- 등록일
	upcg_code   number(8)      NULL,     -- 상위 카테고리 코드
	downcg_code number(8)      NULL      -- 하위 카테고리 코드
);

-- 상품 기본키
CREATE UNIQUE INDEX PK_Products
	ON Products ( -- 상품
		pnum ASC -- 상품번호
	);

-- 상품
ALTER TABLE Products
	ADD
		CONSTRAINT PK_Products -- 상품 기본키
		PRIMARY KEY (
			pnum -- 상품번호
		);

-- 상품
ALTER TABLE Products
	ADD
		CONSTRAINT FK_downCategory_TO_Products -- 하위 카테고리 -> 상품
		FOREIGN KEY (
			upcg_code,   -- 상위 카테고리 코드
			downcg_code  -- 하위 카테고리 코드
		)
		REFERENCES downCategory ( -- 하위 카테고리
			upcg_code,   -- 상위 카테고리 코드
			downcg_code  -- 하위 카테고리 코드
		);

-- 상품
ALTER TABLE Products
	ADD
		CONSTRAINT FK_upCategory_TO_Products -- 상위 카테고리 -> 상품
		FOREIGN KEY (
			upcg_code -- 상위 카테고리 코드
		)
		REFERENCES upCategory ( -- 상위 카테고리
			upcg_code -- 상위 카테고리 코드
		);
------------------------------------------------------
-- 장바구니
ALTER TABLE Cart
	DROP CONSTRAINT FK_Member_TO_Cart; -- 회원 -> 장바구니

-- 장바구니
ALTER TABLE Cart
	DROP CONSTRAINT FK_Products_TO_Cart; -- 상품 -> 장바구니

-- 장바구니
DROP TABLE Cart;

-- 장바구니
CREATE TABLE Cart (
	cnum   number(8)    NOT NULL, -- 장바구니 번호
	qty    number(8)    NOT NULL, -- 수량
	userid VARCHAR2(20) NOT NULL, -- 아이디
	cdate  DATE         NULL,     -- 등록일
	pnum   number(8)    NOT NULL  -- 상품번호
);

-- 장바구니
ALTER TABLE Cart
	ADD
		CONSTRAINT FK_Member_TO_Cart -- 회원 -> 장바구니
		FOREIGN KEY (
			userid -- 아이디
		)
		REFERENCES Member ( -- 회원
			userid -- 아이디
		)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION;

-- 장바구니
ALTER TABLE Cart
	ADD
		CONSTRAINT FK_Products_TO_Cart -- 상품 -> 장바구니
		FOREIGN KEY (
			pnum -- 상품번호
		)
		REFERENCES Products ( -- 상품
			pnum -- 상품번호
		);
-----------------------------------------------
-- 아직 commit하지 않은 테이블-------------------
-- 상품평 게시판
ALTER TABLE Review
	DROP CONSTRAINT FK_Member_TO_Review; -- 회원 -> 상품평 게시판

-- 상품평 게시판
ALTER TABLE Review
	DROP CONSTRAINT FK_Products_TO_Review; -- 상품 -> 상품평 게시판

-- 상품평 게시판
ALTER TABLE Review
	DROP CONSTRAINT PK_Review; -- 상품평 게시판 기본키

-- 상품평 게시판
DROP TABLE Review;

-- 상품평 게시판
CREATE TABLE Review (
	no       number(8)      NOT NULL, -- 글번호
	title    varchar2(200)  NOT NULL, -- 제목
	score    number(1)      NOT NULL, -- 평가점수
	content  varchar2(1000) NULL,     -- 글내용
	filename varchar2(100)  NULL,     -- 첨부파일
	wdate    DATE           NULL,     -- 작성일
	userid   VARCHAR2(20)   NOT NULL, -- 아이디
	pnum     number(8)      NOT NULL  -- 상품번호
);

-- 상품평 게시판 기본키
CREATE UNIQUE INDEX PK_Review
	ON Review ( -- 상품평 게시판
		no ASC -- 글번호
	);

-- 상품평 게시판
ALTER TABLE Review
	ADD
		CONSTRAINT PK_Review -- 상품평 게시판 기본키
		PRIMARY KEY (
			no -- 글번호
		);

-- 상품평 게시판
ALTER TABLE Review
	ADD
		CONSTRAINT FK_Member_TO_Review -- 회원 -> 상품평 게시판
		FOREIGN KEY (
			userid -- 아이디
		)
		REFERENCES Member ( -- 회원
			userid -- 아이디
		)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION;

-- 상품평 게시판
ALTER TABLE Review
	ADD
		CONSTRAINT FK_Products_TO_Review -- 상품 -> 상품평 게시판
		FOREIGN KEY (
			pnum -- 상품번호
		)
		REFERENCES Products ( -- 상품
			pnum -- 상품번호
		)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION;
--------------------------------------------------------
-- 공지사항
ALTER TABLE Notice
	DROP CONSTRAINT FK_Member_TO_Notice; -- 회원 -> 공지사항

-- 공지사항
ALTER TABLE Notice
	DROP CONSTRAINT PK_Notice; -- 공지사항 기본키

-- 공지사항
DROP TABLE Notice;

-- 공지사항
CREATE TABLE Notice (
	nno       number(8)      NOT NULL, -- 글번호
	ntitle    varchar2(200)  NOT NULL, -- 제목
	ncontent  varchar2(1000) NULL,     -- 글내용
	nfilename varchar2(100)  NULL,     -- 첨부파일
	nwdate    DATE           NULL,     -- 작성일
	nuserid   VARCHAR2(20)   NOT NULL  -- 아이디
);

-- 공지사항 기본키
CREATE UNIQUE INDEX PK_Notice
	ON Notice ( -- 공지사항
		nno ASC -- 글번호
	);

-- 공지사항
ALTER TABLE Notice
	ADD
		CONSTRAINT PK_Notice -- 공지사항 기본키
		PRIMARY KEY (
			nno -- 글번호
		);

-- 공지사항
ALTER TABLE Notice
	ADD
		CONSTRAINT FK_Member_TO_Notice -- 회원 -> 공지사항
		FOREIGN KEY (
			nuserid -- 아이디
		)
		REFERENCES Member ( -- 회원
			userid -- 아이디
		)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION;
-------------------------------------------------------------     

        